<?php

define('CPTHEME', 'scholar_admin');

function scholarcp_init(){	
  if (arg(0) == 'scholarcp'){
  	_scholarcp_init_theme();
  } else {
  	$space = spaces_get_space();
  	if ($space -> type == 'og'){
  		og_set_theme($space -> group);
  	}
  }
}

function scholarcp_menu(){
	$spaces_path = drupal_get_path('module', 'spaces');
  //$items = spaces_active_space_menu('og', FALSE, 'scholarcp/settings');

  $items = array();
  
  $items['scholarcp/settings'] = array(
    'title' => 'Settings',
    'page callback' => 'scholarcp_cp',
    'access arguments' => array('administer site configuration'),
  );
  
  $items["scholarcp/settings/features"] = array(
    'title' => 'Features',
    'page callback' => 'drupal_get_form',
    'page arguments' => array('spaces_features_form'),
    'access callback' => 'spaces_admin_access',
    'access arguments' => array('og', 'features'),
    //'access arguments' => array('access content'),
    'file' => 'spaces_admin.inc',
    'file path' => $spaces_path,
    'weight' => 1,
  );
  
  $items["scholarcp/settings/features/%"] = array(
    'title' => 'Features',
    'page callback' => 'drupal_get_form',
    'page arguments' => array('spaces_customize_form', NULL, 3),
    'access callback' => 'spaces_admin_access',
    'access arguments' => array('og', 'features'),
    'file' => 'spaces_admin.inc',
    'file path' => $spaces_path,
    'weight' => 1,
  );

  $items['scholarcp/content'] = array(
    'title' => 'Content',
    'page callback' => 'scholarcp_cp',
    'access arguments' => array('access content'),
  );
  
  $items['scholarcp/users'] = array(
    'title' => 'Users',
    'page callback' => 'scholarcp_cp',
    'access arguments' => array('access content'),
  );

  $items['scholarcp/news'] = array(
    'title' => 'News',
    'page callback' => 'scholarcp_cp',
    'access arguments' => array('access content'),
  ); 
  
  $items['scholarcp/support'] = array(
    'title' => 'Support',
    'page callback' => 'scholarcp_cp',
    'access arguments' => array('access content'),
  );
  
  // make them all part of 'scholarcp' menu
  foreach($items as $path => $item) {
    $items[$path]['menu_name'] = 'scholarcp';
  }

  return $items;
}

function scholarcp_cp(){
  return '1';
}

/**
 * initialize admin theme
 */
function _scholarcp_init_theme(){
	global $custom_theme;
  $custom_theme = CPTHEME;
}


/************* OLD STUFF **********************************/
/**
 * Generates an array of top control panels links for the 
 * current site suitable for use in theme_links().
 */
function scholarcp_cp_top_links() {
  $links = array();

  // anyone can modify add links by implementing 
  // cp_top_links_alter hook
  drupal_alter('cp_top_links', $links);
  return $links;
}


/**
 * Implements cp_top_links_alter
 */
function scholarcp_cp_top_links_alter(&$links) {
  //$site = scholar_get_site ();
  //$sid = $site -> nid;
  
  $sid = scholar_get_site();
  if ($sid) {
    $links[] = array (
      'title' => t ( 'Settings' ), 
      'href' => "scholarcp/$sid/settings", 
      'attributes' => array ('id' => 'settings') 
    );
    
    $links[] = array (
      'title' => t ( 'Content' ), 
      'href' => "scholarcp/$sid/content", 
      'attributes' => array ('id' => 'content') 
    );
    
    $links[] = array (
      'title' => t ( 'Users' ), 
      'href' => "scholarcp/$sid/users", 
      'attributes' => array ('id' => 'users') 
    );
    
    $links[] = array (
      'title' => t ( 'News' ), 
      'href' => "sitecp/$sid/news", 
      'attributes' => array ('id' => 'news') 
    );
  
    $links[] = array (
      'title' => t ( 'Support' ), 
      'href' => "sitecp/$sid/users", 
      'attributes' => array ('id' => 'support') 
    );
  }
}

