<?php

define('CPTHEME', 'scholar_admin');

function scholarcp_init(){
  //print_r(spaces_get_space());
	/*
  $item = menu_get_item();
  $first_in_path = arg(0, $item['path']);
  if($first_in_path == 'scholarcp'){
    global $custom_theme;
    $custom_theme = CPTHEME;
  }
  */
   if (arg(0) == 'scholarcp'){
  	_admin_init_theme();
  }
}

function scholarcp_menu(){
  //$space = spaces_get_space();
  //$items = spaces_active_space_menu('og', FALSE, 'scholarcp/settings');

  //dpm(module_invoke('system','menu'));
  //$items = array();
  
  $items['scholarcp/settings'] = array(
    'title' => 'Settings',
    'page callback' => 'scholarcp_cp',
    'access arguments' => array('administer site configuration'),
  );
  
  $items['scholarcp/settings/features'] = array(
    'title' => 'Features',
    'page callback' => 'scholarcp_cp',
    'access arguments' => array('access content'),
  );
  
  $items['scholarcp/content'] = array(
    'title' => 'Content',
    'page callback' => 'scholarcp_cp',
    'access arguments' => array('access content'),
  );
  
  $items['scholarcp/users'] = array(
    'title' => 'Users',
    'page callback' => 'scholarcp_cp',
    'access arguments' => array('access content'),
  );

  $items['scholarcp/news'] = array(
    'title' => 'News',
    'page callback' => 'scholarcp_cp',
    'access arguments' => array('access content'),
  ); 
  
  $items['scholarcp/support'] = array(
    'title' => 'Support',
    'page callback' => 'scholarcp_cp',
    'access arguments' => array('access content'),
  );
  
  foreach($items as $path => $item) {
    $items[$path]['menu_name'] = 'scholarcp';
  }
  
  return $items;
}

function scholarcp_cp(){
  return '1';
}

/**
 * Implementation of hook_menu_alter().
 */
function scholarcp_menu_alter(&$items) {
	$items['scholarcp/settings/%node/spaces/features'] = $items['node/%node/spaces/features'];
	$items['scholarcp/settings/%node/spaces/features']['access arguments'] = array(2, 'og', 'features');
	$items['scholarcp/settings/%node/spaces/features']['type'] = MENU_CALLBACK;
	$items['scholarcp/%node/spaces/features/%'] = $items['node/%node/spaces/features/%'];

}


function scholarcp_settings(){
  return 'hello there from settings page';
}

/**
 * Generates an array of top control panels links for the 
 * current site suitable for use in theme_links().
 */
function scholarcp_cp_top_links() {
  $links = array();

  // anyone can modify add links by implementing 
  // cp_top_links_alter hook
  drupal_alter('cp_top_links', $links);
  return $links;
}


/**
 * Implements cp_top_links_alter
 */
function scholarcp_cp_top_links_alter(&$links) {
  //$site = scholar_get_site ();
  //$sid = $site -> nid;
  
  $sid = scholar_get_site();
  if ($sid) {
    $links[] = array (
      'title' => t ( 'Settings' ), 
      'href' => "scholarcp/$sid/settings", 
      'attributes' => array ('id' => 'settings') 
    );
    
    $links[] = array (
      'title' => t ( 'Content' ), 
      'href' => "scholarcp/$sid/content", 
      'attributes' => array ('id' => 'content') 
    );
    
    $links[] = array (
      'title' => t ( 'Users' ), 
      'href' => "scholarcp/$sid/users", 
      'attributes' => array ('id' => 'users') 
    );
    
    $links[] = array (
      'title' => t ( 'News' ), 
      'href' => "sitecp/$sid/news", 
      'attributes' => array ('id' => 'news') 
    );
  
    $links[] = array (
      'title' => t ( 'Support' ), 
      'href' => "sitecp/$sid/users", 
      'attributes' => array ('id' => 'support') 
    );
  }
}

