diff --git a/includes/database/database.inc b/includes/database/database.inc
index 6879f69..6dac1ac 100644
--- a/includes/database/database.inc
+++ b/includes/database/database.inc
@@ -1,6 +1,14 @@
 <?php
 
 /**
+ * Sorry to patch core; fixes known APC "cannot redeclare class" bug.
+ *
+ * @see https://drupal.org/node/838744
+ * @see http://goo.gl/JZi05
+ */
+if (!class_exists('insertquery_mysql')) {
+
+/**
  * @file
  * Core systems for the database layer.
  *
@@ -1962,6 +1970,8 @@ class DatabaseTransaction {
     // If we rolled back then the transaction would have already been popped.
     if (!$this->rolledBack) {
       $this->connection->popTransaction($this->name);
+      DrupalCache::commit($this->connection->transactionDepth());
+
     }
   }
 
@@ -1987,6 +1997,7 @@ class DatabaseTransaction {
   public function rollback() {
     $this->rolledBack = TRUE;
     $this->connection->rollback($this->name);
+    DrupalCache::rollback($this->connection->transactionDepth());
   }
 }
 
@@ -3096,3 +3107,8 @@ function db_ignore_slave() {
     $_SESSION['ignore_slave_server'] = REQUEST_TIME + $duration;
   }
 }
+
+/**
+ * @see top of this file.
+ */
+}
