<?php
/**
 * @file
 * Code for the OS Slideshow feature.
 */

include_once 'os_slideshow.features.inc';

/**
 * Implements hook_menu()
 */
function os_slideshow_menu() {
  $items['os/slideshow/%'] = array(
    'title' => 'Add Slide',
    'page callback' => 'drupal_get_form',
    'page arguments' => array('slideshow_image_node_form'),
    'access callback' => 'boxes_access_admin',
    'type' => MENU_LOCAL_TASK,
    //'context' => MENU_CONTEXT_INLINE,
  );
  return $items;
}

/**
 * Implements hook_boxes_plugins().
 */
function os_slideshow_boxes_plugins(){
  $info = array();
  $path = drupal_get_path('module', 'os_slideshow') . '/plugins';

  $info['os_slideshow_box'] = array(
    'title' => 'New Slideshow',
    'description' => 'Slideshow',
    'tags' => array('Media'),
    'handler' => array(
      'class' => 'os_slideshow_box',
      'file' => 'os_slideshow_box.inc',
      'path' => $path,
      'parent' => 'os_boxes_default'
    )
  );

  return $info;
}


/**
 * Implements hook_block_view_alter
 * 
 *  Adds 'add new slide' link to slideshow's contextual menu.
 **/
function os_slideshow_block_view_alter(&$block, &$data) {
  if (isset($block['boxes_plugin']) && ($block['boxes_plugin'] == 'os_slideshow_box')) {
    $block['content']['#contextual_links']['node'] = array(
      0 => 'os/slideshow',
      1 => array($block['delta']),  
    );
  }
  $block;
}

/**
 * Implements hook_form_FORMID_alter

//  */
// function os_slideshow_form_slideshow_image_node_form_alter(&$form, &$state, $form_id) {
//   $form['widget'] = array('#type' => 'hidden', '#value' => '');
// }

// function os_slideshow_add_slide($widget) {
//   $form = drupal_get_form('slideshow_image_node_form');
//   $form['widget']['#value'] = $widget;
//   return drupal_render($form);
// }