<?php
// $Id$

/**
 * @file
 * 
 * OS Reports module file
 */


/**
 * Implement hook_permission().
 */
function os_reports_permission() {
  return array(
    'access os reports' => array(
      'title' => t('View OS Reports'),
      'description' => t('Access the OS reports.'),
      'restrict access' => TRUE,
    ),
  );
}

/**
 * Implement hook_menu().
 */
function os_reports_menu() {
  $items = array();
  $items['admin/reports/site'] = array(
    'title' => 'Sites Report',
    'page callback' => 'drupal_get_form',
    'page arguments' => array('os_reports_site_form'),
    'access arguments' => array('access os reports'),
    'description' => 'Report on various aspects of all the sites hosted by OpenScholar.',
    'file' => 'os_reports.admin.inc',
  );
  $items['admin/reports/user'] = array(
    'title' => 'Users Report',
    'page callback' => 'drupal_get_form',
    'page arguments' => array('os_reports_user_form'),
    'access arguments' => array('access os reports'),
    'description' => 'Report on various aspects of all the users associated with OpenScholar sites.',
    'file' => 'os_reports.admin.inc',
  );
  return $items;
}

/**
 * Move angular to the top of the list scripts list.
 * We need it to load before jQuery because the version in Drupal is too old.
 */
function os_reports_process_html(&$vars) {
  $search = '<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/angularjs/1.0.7/angular.js"></script>';
  $style = str_replace($search, '', $vars['scripts'], $count);
  if ($count) {
    $vars['scripts'] = $search . "\n" . $style;
  }
}
