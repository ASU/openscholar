<?php

include('os_boxes.plugins.inc');

/**
 * Implements hook_ctools_plugin_api().
 */
function os_boxes_ctools_plugin_api($module, $api) {
  if ($module == 'boxes' && $api == 'plugins') {
    return array('version' => 1);
  }
}

/**
 * Implements hook_menu().
 */
function os_boxes_menu() {
  $item['os/boxes/%os_boxes'] = array(
    'title' => 'Add/Edit Widget',
    'page callback' => 'os_boxes_edit_widget',
    'page arguments' => array(2),
    'access callback' => 'boxes_access_admin',
    'type' => MENU_CALLBACK,
    'file' => 'os_boxes.admin.inc',
  );
  return $item;
}

/**
 * Implements hook_load().
 */
function os_boxes_load($key) {
  if ($box = boxes_box_load($key)) {
    // this is an instance;
    return $box;
  }
  if ($box = boxes_factory($key)) {
    // this is a plugin, so create a new box
    return $box;
  }
  return false;
}

function os_boxes_admin_paths() {
  $paths = array(
    'os/boxes/*' => TRUE,
  );

  return $paths;
}

function os_boxes_preprocess_boxes_box(&$variables) {
  $block = &$variables['block'];
  $block['controls'] = theme('links', array(
    'links' => array(
      'edit' => array(
        'title' => t('Edit Widget'),
        'href' => 'os/boxes/'.$block['delta'],
        'attributes' => array(
          'class' => 'boxes-processed',
        ),
      ),
    ),
  ));
}

/**
 * Implements hook os_widget
 *
 * @returns array
 *    All of the blocks that os_boxes would like to be avalible in the layout
 */
function os_boxes_vsite_widget(){

  //Block can make use of any field in the block schema
  
  return array();
  
}

/**
 * Implementation of hook os_widget_alter
 *
 * This function should add any parameters to the passed block that
 * will be needed in the admin user interfaces.  Including access params
 * config paths etc...
 *
 * @param $widget
 */
function os_boxes_os_widget_alter(&$widget){
  if($widget->module == 'boxes'){
    $widget['config_path'] = '/my/conf/path';
  }
}